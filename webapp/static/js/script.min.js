var OpenRIS={a:6378137,b:(6378137*297.257223563)/298.257223563,region:{},search_params:{},start_method_queue:new Array(),monthstr:{"01":"Januar","02":"Februar","03":"MÃ¤rz","04":"April","05":"Mai","06":"Juni","07":"Juli","08":"August","09":"September","10":"Oktober","11":"November","12":"Dezember"},streetsForPosition:function(d,e,f,c,g){$.getJSON("/api/streets",{region:d,lat:e,lon:f,radius:c},g)},paperDetails:function(d,c){options={reference:d,output:"meetings,files,thumbnails"};$.getJSON("/api/paper",options,c)},regionLoad:function(){this.region=region_data;$("#change-region").click(function(){$.getJSON("/api/regions",function(c){$.each(c,function(d,e){$("#region-question").css({display:"none"});$("<span/>").text(e.name).attr({"class":"awesome extrawide"}).click({region:e},function(f){OpenRIS.region={id:f.data.region.id,name:f.data.region.name,lat:f.data.region.lat,lon:f.data.region.lon,zoom:f.data.region.zoom,type:f.data.region.type,keyword:f.data.region.keyword};$("#region-choice").html("");$("#region-question").css({display:"block"});$("#region-current").text(OpenRIS.region.name);sessionParams={region_id:OpenRIS.region.id};OpenRIS.session(sessionParams,function(){});if(typeof(OpenRIS.post_region_change)=="function"){OpenRIS.post_region_change()}}).appendTo("#region-choice")})})})},formatIsoDate:function(e){if(e!=null&&typeof e!="undefined"){var d=e.substr(0,4);var f=e.substr(5,2);var c=e.substr(8,2);return parseInt(c,10)+". "+this.monthstr[f]+" "+d}return e},truncateText:function(d,c){if(d.length<=c){return d}list=d.split(/\s+/);newtext="";while(newtext.length<c){newtext=newtext+" "+list.shift()}return newtext.trim()+"&nbsp;&hellip;"},fileSizeString:function(c){if(c<(1024*700)){return Math.round(c/1024)+" KB"}else{if(c<(1024*1024*5)){return(c/1024/1024).toFixed(1).replace(".",",")+" MB"}}return(c)},processSearchParams:function(c){c.r=OpenRIS.region.id;if(typeof c.q==="undefined"||c.q==null||c.q===""||c.q==="*:*"){delete c.q}if(typeof c.fq==="undefined"||c.fq==null||c.fq===""||c.fq==="*:*"){delete c.fq}if(typeof c.num=="undefined"||c.num==null||c.num==""||c.num<=10){delete c.num}if(typeof c.start=="undefined"||c.start==null||c.start==""||c.start<=0){delete c.start}if(typeof c.sort=="undefined"||c.sort==null||c.sort==""){delete c.sort}if(typeof c.date=="undefined"||c.date==null||c.date==""){delete c.date}return c},deepCopy:function(e){if(typeof e!=="object"){return e}if(e.constructor===RegExp){return e}var d=new e.constructor();for(var c in e){if(!e.hasOwnProperty(c)){continue}d[c]=OpenRIS.deepCopy(e[c])}return d},search:function(d,e){var c=OpenRIS.processSearchParams(d);$.getJSON("/api/papers",c,e)},session:function(c,d){$.getJSON("/api/session",c,d)},filterGeocodingChoices:function(d){d=OpenRIS.deepCopy(d);for(var e in d){d[e].okquality=1;if(d[e].address.suburb!=""){d[e].okquality*=3}if(d[e].address.postcode!=""){d[e].okquality*=3}if(typeof(d[e].address.road)==="undefined"){d[e].okquality*=0.1}}d.sort(OpenRIS.qualitySort);var c={};var e;for(e in d){if(typeof(c[d[e].address.postcode])==="undefined"){c[d[e].address.postcode]=d[e]}}ret=[];for(e in c){ret.push(c[e])}ret.sort(OpenRIS.longitudeSort);return ret},qualitySort:function(d,c){return c.okquality-d.okquality},longitudeSort:function(d,c){return parseFloat(d.lon)-parseFloat(c.lon)},cylindrics:function(h){var e=this.a*Math.cos(h),d=this.b*Math.sin(h),c=Math.sqrt(e*e+d*d),g=this.a*e/c,i=this.b*d/c,f=Math.sqrt(g*g+i*i);return{r:g,z:i,R:f}},geo_distance:function(phi1,lon1,phi2,lon2,small){var dLambda=lon1-lon2;with(cylindrics(phi1)){var r1=r,z1=z,R1=R}with(cylindrics(phi2)){var r2=r,z2=z,R2=R}var cos_dLambda=Math.cos(dLambda),scalar_xy=r1*r2*cos_dLambda,cos_alpha=(scalar_xy+z1*z2)/(R1*R2);if(small){var dr2=r1*r1+r2*r2-2*scalar_xy,dz2=(z1-z2)*(z1-z2),R=Math.sqrt((dr2+dz2)/(2*(1-cos_alpha)))}else{R=Math.pow(a*a*b,1/3)}return R*Math.acos(cos_alpha)},endsWith:function(d,c){return d.indexOf(c,d.length-c.length)!==-1},send_response:function(c){alert(c);return false},loadGeoLiveSearch:function(){$.geosearchbox={};$.extend(true,$.geosearchbox,{settings:{url:"/search",param:"query",dom_id:"#results",delay:100,loading_css:"#loading",show_results:function(c){$($.geosearchbox.settings.dom_id).html(c)}},loading:function(){$($.geosearchbox.settings.loading_css).show()},resetTimer:function(c){if(c){clearTimeout(c)}},idle:function(){$($.geosearchbox.settings.loading_css).hide()},process:function(c){var g=$.geosearchbox.settings.url.split("?"),f=[$.geosearchbox.settings.param,"=",c].join(""),e=g[0],h=g[1],d=f;if(h){d=[h.replace("&amp;","&"),f].join("&")}$.get([e,"?",d].join(""),function(i){$.geosearchbox.settings.show_results(i)})},start:function(){$(document).trigger("before.searchbox");$.geosearchbox.loading()},stop:function(){$.geosearchbox.idle();$(document).trigger("after.searchbox")}});$.fn.geosearchbox=function(c){var d=$.extend(true,$.geosearchbox.settings,c||{});$(document).trigger("init.searchbox");$.geosearchbox.idle();return this.each(function(){var e=$(this);e.ajaxStart(function(){$.geosearchbox.start()}).ajaxStop(function(){$.geosearchbox.stop()}).keyup(function(){if(e.val()!=this.previousValue){$.geosearchbox.resetTimer(this.timer);this.timer=setTimeout(function(){$.geosearchbox.process(e.val())},$.geosearchbox.settings.delay);this.previousValue=e.val()}})})}},loadPaperLiveSearch:function(){$.papersearchbox={};$.extend(true,$.papersearchbox,{settings:{url:"/search",param:"query",dom_id:"#results",delay:100,loading_css:"#loading",show_results:function(c){$($.papersearchbox.settings.dom_id).html(c)}},loading:function(){$($.papersearchbox.settings.loading_css).show()},resetTimer:function(c){if(c){clearTimeout(c)}},idle:function(){$($.papersearchbox.settings.loading_css).hide()},process:function(c){var g=$.papersearchbox.settings.url.split("?"),f=[$.papersearchbox.settings.param,"=",c].join(""),e=g[0],h=g[1],d=f;if(h){d=[h.replace("&amp;","&"),f].join("&")}$.get([e,"?",d].join(""),function(i){$.papersearchbox.settings.show_results(i)})},start:function(){$(document).trigger("before.searchbox");$.papersearchbox.loading()},stop:function(){$.papersearchbox.idle();$(document).trigger("after.searchbox")}});$.fn.papersearchbox=function(c){var d=$.extend(true,$.papersearchbox.settings,c||{});$(document).trigger("init.searchbox");$.papersearchbox.idle();return this.each(function(){var e=$(this);e.ajaxStart(function(){$.papersearchbox.start()}).ajaxStop(function(){$.papersearchbox.stop()}).keyup(function(){if(e.val()!=this.previousValue){$.papersearchbox.resetTimer(this.timer);this.timer=setTimeout(function(){$.papersearchbox.process(e.val())},$.papersearchbox.settings.delay);this.previousValue=e.val()}})})}}};