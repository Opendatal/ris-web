$(document).ready(function(){OpenRIS.regionLoad();if(typeof openris_search_settings!=undefined){OpenRIS.search_params=OpenRIS.deepCopy(openris_search_settings);OpenRIS.search_params.output="facets";b()}function b(){url=Array();$.each(OpenRIS.search_params,function(p,q){if(q){url.push(p+"="+String(q).replace(/&#34;/g,'"'))}});window.history.pushState(String(Date.now()),document.title,"/suche?"+url.join("&"));$("#search .result").empty();$("#search .result").append('<div class="loading big outer"><div class="loading big inner">Suche...</div></div>');OpenRIS.search(OpenRIS.search_params,function(p){$("#search .result").empty();$("#facets").remove();if(p.status==0){if(typeof p.response.facets!="undefined"){$("#search-form").after('<div id="facets" class="content middle"></div>');h(p.response.facets,p.request,"#facets")}e(p);c(p.response.numhits,openris_search_settings.ppp,p.response.start,"#search .result");if(p.response.numhits>1){d(p.request,"#search .result h3")}}else{g()}})}$("#search-submit").click(function(p){p.preventDefault();OpenRIS.search_params.start=0;OpenRIS.search_params.q=$("#qinput").val();b()});$("#searchform").submit(function(p){p.preventDefault();OpenRIS.search_params.start=0;OpenRIS.search_params.q=$("#qinput").val();b()});OpenRIS.post_region_change=function(){OpenRIS.search_params.r=OpenRIS.region.id;OpenRIS.search_params.start=0;OpenRIS.search_params.q=$("#qinput").val();console.log("weee");$("#search-form").attr({action:"/suche?r="+OpenRIS.region.id});b()};function a(q,s){var r=[];for(var p in q){r.push({key:p,value:q[p]})}if(s=="key"){r.sort(j)}else{if(s=="value"){r.sort(k)}}return r}function j(q,p){return p.key-q.key}function k(q,p){return p.value-q.value}function h(s,r,q){if(typeof s!="undefined"){fq=r.fq;var p=true;x=0;result=new Object();while(p){y=fq.indexOf(":",x);if(y==-1){break}temp=fq.substring(x,y);x=y+1;if(fq.substring(x,x+5)=="&#34;"){y=fq.indexOf("&#34;",x+5);if(y==-1){break}result[temp]=fq.substring(x+5,y);x=y+6;if(x>fq.length){break}}else{y=fq.indexOf(";",x);if(y==-1){result[temp]=fq.substring(x,fq.length);break}else{result[temp]=fq.substring(x,y);x=y+1}}}paperType_facet=i("paperType",s.paperType,"Typ","value",result);$(q).append(paperType_facet);bodyName_facet=i("bodyName",s.bodyName,"Körperschaft","value",result);$(q).append(bodyName_facet);publishedDate_facet=i("publishedDate",s.publishedDate,"Erstellungsdatum","",result,true);$(q).append(publishedDate_facet)}}function i(p,t,r,A,v,C){var w=a(t,A);var q=$(document.createElement("div")).attr("class","facet "+p);var u=$(document.createElement("ul")).attr("class","facet");if(v[p]){var B=v[p];if(p=="publishedDate"){B=OpenRIS.monthstr[B.substr(5,7)]+" "+B.substr(0,4)}if(C==true){B=B.replace(/^[0-9]+\s+/,"")}var z="";for(var s in v){if(s!=p){if(z){z+=";"}z+=s+":"+o(v[s])}}if(!z){z=null}$("<li>").attr("class","current").append($("<a>").attr("href","/suche?"+m({fq:z})).attr("title","Diese Einschränkung aufheben").click({sqs:z},function(D){D.preventDefault();if(D.data.sqs){OpenRIS.search_params.fq=D.data.sqs.replace(/\"/g,"&#34;")}else{OpenRIS.search_params.fq=null}b()}).append($("<span>").attr("class","facetdel").text("✕")).append($("<span>").attr("class","facetlabel").text(B.replace(/&#34;/g,"").replace(/\"/g,"")))).appendTo(u)}else{for(var s in w){var B=w[s].key;if(C==true){B=B.replace(/^[0-9]+\s+/,"")}if(p=="publishedDate"){B=OpenRIS.monthstr[B.substr(5,7)]+" "+B.substr(0,4)}if(!OpenRIS.search_params.fq){z=p+":"+o(w[s].key)}else{z=OpenRIS.search_params.fq+";"+p+":"+o(w[s].key)}list_element=$("<li>").append($("<a>").attr("href","/suche?"+m({fq:z})).attr("title","Auswahl einschränken").click({sqs:z},function(D){D.preventDefault();OpenRIS.search_params.fq=D.data.sqs.replace(/\"/g,"&#34;");b()}).append($("<span>").attr("class","facetlabel").text(B.replace(/&#34;/g,"").replace(/\"/g,""))).append(" ").append($("<span>").attr("class","num").text(w[s].value)));if(p=="publishedDate"){list_element.prependTo(u)}else{list_element.appendTo(u)}}}q.append('<div class="header">'+r+"</div>");q.append(u);return q}function o(p){if(p.indexOf(" ")!=-1){p='"'+p+'"'}return p}function g(){$("#search .result").append('<h2>Fehler bei der Suche</h2><p>Es ist ein unerwarteter Fehler aufgetreten. Bitte probier es noch einmal.</p><p>Wenn das Problem weiterhin besteht, bitte kopiere den Inhalt der Adresszeile in eine E-Mail und sende sie an <a href="kontakt@politik-bei-uns.de">kontakt@politik-bei-uns.de</a>. Vielen Dank!</p>')}function e(q){var A=$("#search .result");$("h1").text(q.response.numhits+" gefundene Dokumente");if(q.response.numhits>0){var t=$(document.createElement("h3"));t.text("Seite "+(Math.floor(q.response.start/openris_search_settings.ppp)+1)+" von "+(Math.ceil(q.response.numhits/openris_search_settings.ppp)));A.append(t)}var w=$(document.createElement("ol"));w.attr("start",q.response.start+1);A.append(w);for(var r in q.response.result){var z=$(document.createElement("li")).attr("class","resultitem");w.append(z);var u=$(document.createElement("a")).attr("href","/paper/"+q.response.result[r]["id"]);z.append(u);var v=$(document.createElement("span")).attr("class","title").html(n(q.response.result[r]));u.append(v);var s=$(document.createElement("span")).attr("class","metainfo");s.text(f(q.response.result[r]));u.append(s);if(q.response.result[r]["fileFulltext"]){var p=$(document.createElement("p")).attr("class","snippet");p.html(l(q.response.result[r]));z.append(p)}}}function n(p){if(p.name!==""){if(typeof p.highlighting!="undefined"&&typeof p.highlighting.title!="undefined"){return p.highlighting.title}return p.name}else{return"Dokument ohne Name"}}function f(p){return p.paperType+" aus "+p.bodyName+" vom "+OpenRIS.formatIsoDate(p.publishedDate)}function l(p){return"... "+p.fileFulltext+" ..."}function c(q,s,t,r){var p=$(document.createElement("div"));p.attr("class","pager");$(r).append(p);if(t>0){$("<a>").attr("class","awesome extrawide paging back").attr("href","/suche?"+m({start:(t-OpenRIS.search_params.ppp)})).text("← Seite zurück").click(function(u){u.preventDefault();OpenRIS.search_params.start=t-OpenRIS.search_params.ppp;b()}).appendTo(p)}p.append(" ");if(q>(t+s)){$("<a>").attr("class","awesome extrawide paging next").attr("href","/suche?"+m({start:(t+OpenRIS.search_params.ppp)})).text("Seite weiter →").click(function(u){u.preventDefault();OpenRIS.search_params.start=t+OpenRIS.search_params.ppp;b()}).appendTo(p)}}function d(r,p){var q=$(document.createElement("span"));q.attr("class","sort");$(p).append(q);q.append(" &ndash; sortiert nach ");var t=true;var u={"score:desc":"Relevanz","publishedDate:desc":"Datum: neuste zuerst","publishedDate:asc":"Datum: älteste zuerst"};for(var s in u){if(t){t=false}else{q.append(" | ")}if(r.sort==s){$("<b>").text(u[s]).appendTo(q)}else{$("<a>").attr("href","/suche?"+m({start:0,sort:s})).text(u[s]).click({o:s},function(v){v.preventDefault();OpenRIS.search_params.start=0;OpenRIS.search_params.sort=v.data.o;b()}).appendTo(q)}}}function m(p){var q=OpenRIS.deepCopy(OpenRIS.search_params);for(var r in p){if(p[r]==null||typeof p[r]=="undefined"){delete q[r]}else{q[r]=p[r]}}q=OpenRIS.processSearchParams(q);var s=[];for(var r in q){s.push(r+"="+encodeURI(q[r]))}return s.join("&")}});